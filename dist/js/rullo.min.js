let e={loaded:!1,load:(t,s,n)=>{if(e.loaded)return;e.loaded=!0;let a=[];for(let l=0;l<t*t;l++)a.push(e.random(s,n));let l=e.punch([...a]),{rows:r,cols:o}=e.solve(t,l);return{matrix:a,rows:r,cols:o}},random:(e,t)=>{const s=Math.ceil(e),n=Math.floor(t)+1;return Math.floor(Math.random()*(n-s)+s)},solve:(t,s)=>{let n=parseInt(t),a=s,l=[],r=[];for(let s=0;s<t;s++){let o=a.slice(s*n,s*n+n),i=e.col(a,t,s);l.push(e.sum(o)),r.push(e.sum(i))}return{rows:l,cols:r}},sum:e=>e.reduce(((e,t)=>e+t),0),col:(e,t,s)=>e.filter(((e,n)=>n===s||n%t===s)),punch:t=>{let s=Math.floor(e.random(25,50)/100*t.length),n=t;for(;s>1;){let t=e.random(0,n.length);0!=n[t]&&(n[t]=0,s--)}return n}},t={loaded:!1,check:e=>{let s=t.row(e),a=t.col(e);for(let t of n(e.target))s?t.classList.add("success"):t.classList.remove("success");for(let t of l(e.target))a?t.classList.add("success"):t.classList.remove("success")},row:e=>{let t,n,a;t=e.target.classList.contains("inactive")?0:parseInt(e.target.innerHTML);for(let a of s(e.target))a.classList.contains("inactive")||a.classList.contains("sum")?a.classList.contains("sum")?n=parseInt(a.innerHTML):console.log():t+=parseInt(a.innerHTML);return a=t===n,a},col:e=>{let t,s,n=0;var l=Array.from(e.target.parentNode.children).indexOf(e.target)-1;t=parseInt(document.querySelector(".cols").children.item(l).innerHTML);for(let t of a(e.target))t.classList.contains("inactive")||(n+=parseInt(t.innerHTML));return s=n===t,s}},s=e=>{let t=[],s=e.parentNode.firstChild;for(;s;)1===s.nodeType&&s!==e&&t.push(s),s=s.nextSibling;return t},n=e=>{let t=[];for(let n of s(e))n.classList.contains("sum")&&t.push(n);return t},a=e=>{let t=[];var s=Array.from(e.parentNode.children).indexOf(e);for(let e of document.getElementsByClassName("row")){let n=e.children;t.push(n.item(s))}return t},l=e=>{let t=[];var s=Array.from(e.parentNode.children).indexOf(e)-1;for(let e of document.getElementsByClassName("cols"))t.push(e.children.item(s));return t},r={loaded:!1,setup:(e,t)=>{},click:()=>{let e=document.getElementsByClassName("cell");Array.from(e).forEach(((e,s)=>{e.addEventListener("click",(e=>{e.target.classList.toggle("inactive"),t.check(e)}))}))},load:(e,t,s)=>{let n=document.getElementsByClassName("cell");Array.from(n).forEach(((t,s)=>{t.innerHTML=e[s]}));for(let e of document.getElementsByClassName("cols"))Array.from(e.children).forEach(((e,t)=>{e.innerHTML=s[t]}));for(let e of document.getElementsByClassName("row")){let s=t.shift();for(let t of e.getElementsByClassName("sum"))t.innerHTML=s}r.click()}},o={loaded:!1,timers:[]};function i(e,t){return e.toLocaleString("en-US",{minimumIntegerDigits:t,useGrouping:!1})}o.start=e=>{o.startTime=new Date,o.startTime.setSeconds(o.startTime.getSeconds()+parseInt(e))},o.initialize=e=>{for(let e of document.getElementsByClassName("timer"))o.timers.push(e);o.start(e),o.interval=setInterval(o.loop,1e3)},o.loop=()=>{var e=(new Date).getTime();let t=o.startTime-e;if(t<=1)o.hide(),o.clear();else{let e=Math.floor(t%36e5/6e4),s=Math.floor(t%6e4/1e3);for(let t of o.timers){let n=e>0?e+":"+i(s,2):"0:"+i(s,2);t.innerHTML=n}}},o.clear=()=>{clearInterval(o.interval)},o.hide=()=>{for(let e of o.timers)e.classList.add("hidden")};const c={size:null,sequenceStart:null,sequenceEnd:null,setSize:e=>{c.size=e;for(let e of document.getElementsByClassName("selection size"))e.classList.toggle("hidden");c.allSet()},setSequence:(e,t)=>{c.sequenceStart=e,c.sequenceEnd=t;for(let e of document.getElementsByClassName("selection sequence"))e.classList.toggle("hidden");c.allSet()},sizeClick:()=>{for(let e of document.getElementsByClassName("selection size"))e.addEventListener("click",(function(e){e.target.dataset.size&&c.setSize(e.target.dataset.size)}))},sequenceClick:()=>{for(let e of document.getElementsByClassName("selection sequence"))e.addEventListener("click",(function(e){e.target.dataset.sequenceStart&&e.target.dataset.sequenceEnd&&c.setSequence(e.target.dataset.sequenceStart,e.target.dataset.sequenceEnd)}))},onLoad:()=>{const e=document.body;e.dataset,"timer"in e.dataset&&o.initialize(e.dataset.timer),"size"in e.dataset&&c.setSize(e.dataset.size),"sequenceStart"in e.dataset&&"sequenceEnd"in e.dataset&&c.setSequence(e.dataset.sequenceStart,e.dataset.sequenceEnd),c.size&&c.sequenceStart&&c.sequenceEnd?c.allSet():c.size?c.sequenceClick():(c.sequenceStart&&c.sequenceEnd||c.sequenceClick(),c.sizeClick())},allSet:()=>{if(c.size&&c.sequenceStart&&c.sequenceEnd&&!e.loaded){let{matrix:t,rows:s,cols:n}=e.load(5,1,4);r.load(t,s,n)}}};window.onload=function(){c.onLoad()};
